---
layout:     post
title:      "Aceberg设计思路"
author:     “silsuer”
header-img: "img/post-bg-re-vs-ng2.jpg"
tags:
    - PHP
---

# Aceberg 最初构想

## 基础架构

想要写一套完整的扩展性强Web系统，快速构建各类网站以及APP

基于Lumen框架，使用前后端分离技术，后端只提供各种组件接口，前端负责视图渲染

所有功能，全部组件化，多个组件组成插件和模型

## 缺点

前端：
  1. 模版渲染速度慢，当ajax请求结束后才能开始渲染
  
  2. 页面显示不完整，多个ajax请求很容易挂掉几个，导致页面显示不完全
  
  3. 手写组件十分麻烦，原来的初衷是，抽象出来的组件可以到处使用，但是现在看来，背离初衷
  
后端：
  
  1. Lumen和Laravel一样，封装度太高，无法进行太多的细节拆解和优化
  
  2. 组件、插件、模型等无法重名，原来的每一个组件是一个文件夹，渲染到前端目录的时候，如果
  
     有重名的组件，后面的会覆盖掉前面的
     
  3. 组件、模型、插件之间的依赖关系没有一个清晰的定义，应该是组件、模型、插件都存放在各自的目录中，在目录下
  
     写一个完整的描述，描述这个组件或者插件用到了什么依赖，挂载了哪些钩子
     
  4. 由于一次完整的http请求，就是一个php程序的完整生命周期，加上php-fpm的同步阻塞的机制，导致运行速度太差
  
 所以根据最近完成的项目总结出来的经验，设立新的aceberg基础架构
 
 # Aceberg 新架构
 
 ## 基础描述
 
  1. 抛弃前后端分离的做法，使用模版渲染引擎，添加大量自定义标签，进行前端渲染
  
  2. 重新定义组件的命名规则，参考composetr的packages的命名规范
  
  3. 重新规范项目的目录结构
  
  4. 将标签，组件，插件，模型完全分离，它们之间的依赖只需要通过一个描述文件进行说明即可
  
  5. 引入Redis，将常用数据缓存在Redis中，加快访问速度
  
  5. 引入Swoole异步通讯框架，将标签、组件分别组织成一棵依赖树并保存在Redis或内存中
  
## 目录结构

   ```go
    
       aceberg                                                       // 项目根目录
         |----app                                                    //开发逻辑放置的地方
               |---Components                                        //第三方组件目录
                     |----<comp_name dir>                            // 一个组件就是一个目录
                              |----<comp_name>.php                   // 组件功能文件，当一个组件需要多个类时，<comp_name>.php 是入口类
                              |----description.json                  // 组件的描述文件，记录了组件的依赖等数据
               |---Model                                             // 第三方模型目录
                     |----<model_name> dir
                              |----<model_name>.php                  // 模型功能文件
                              |----<description>.json                // 模型描述文件
               |---Plugins                                           // 第三方插件目录
                      |----<plugin_name> dir
                              |----<plugin_name>.php                 // 插件功能文件
                              |----<description>.json                // 插件描述文件
               |---Tags                                              // 第三方模版标签目录
         |----config                                                 // 所有配置文件      
         |----core                                                   // 内置功能逻辑的目录
               |---Components                                        // 内置组件目录，内部结构同上
               |---Model                                             // 内置模型目录
               |---Plugins                                           // 内置插件目录
               |---Tags                                              // 内置模版标签目录
         |----vendor                                                 // 第三方包
         |----composer.json                                          // composer配置文件
   ```


